<?php

if ($_SERVER["REQUEST_METHOD"] == "GET") {
    echo "Forbidden";
}

if ($_SERVER["REQUEST_METHOD"] == "POST") {
    if (isset($_POST['mathex'])) {
        $var = $_POST['mathex'];

        $arr = explode(" ", $var);

        if (is_numeric($arr[0]) && is_numeric($arr[2])) {
            if ($arr[1] == "+") {
                $out = serialize(array("sum", $arr[0], $arr[2]));
            } else if ($arr[1] == "-") {
                $out = serialize(array("sub", $arr[0], $arr[2]));
            } else if ($arr[1] == "*") {
                $out = serialize(array("mul", $arr[0], $arr[2]));
            } else if ($arr[1] == "/") {
                $out = serialize(array("div", $arr[0], $arr[2]));
            } else {
                $out = serialize(array("opp_error", $var));
            }
        } else {
            $out = serialize(array("format_error", $var));
        }

        $encoded = base64_encode($out);
        if ($_SERVER["SERVER_PORT"] != "80") {
            header("Location: http://".$_SERVER["SERVER_NAME"].":".$_SERVER["SERVER_PORT"]."/?input=".$encoded, true, 302); 
        } else {
            header("Location: http://".$_SERVER["SERVER_NAME"]."/?input=".$encoded, true, 302); 
        }
        exit();
    } else {
        if ($_SERVER["SERVER_PORT"] != "80") {
            header("Location: http://".$_SERVER["SERVER_NAME"].":".$_SERVER["SERVER_PORT"], true, 302); 
        } else {
            header("Location: http://".$_SERVER["SERVER_NAME"], true, 302); 
        }
        exit();
    }
}
?>
